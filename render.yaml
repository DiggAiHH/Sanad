# ==============================================================================
# SANAD - Render.com Blueprint
# ==============================================================================
# Deploys: Backend API + PostgreSQL (Free Tier)
# 
# Usage:
# 1. Push to GitHub
# 2. Connect repo at https://dashboard.render.com/blueprints
# 3. Select this render.yaml
# 4. Deploy
# ==============================================================================

services:
  # ============================================================================
  # FastAPI Backend
  # ============================================================================
  - type: web
    name: sanad-api
    runtime: docker
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    region: frankfurt  # EU f√ºr Datenschutz
    plan: free
    healthCheckPath: /health
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: sanad-db
          property: connectionString
      - key: JWT_SECRET_KEY
        generateValue: true
      - key: JWT_ALGORITHM
        value: HS256
      - key: JWT_ACCESS_TOKEN_EXPIRE_MINUTES
        value: "30"
      - key: JWT_REFRESH_TOKEN_EXPIRE_DAYS
        value: "7"
      - key: DEBUG
        value: "true"
      - key: CORS_ORIGINS
        value: "https://sanad-admin.netlify.app,https://sanad-mfa.netlify.app,https://sanad-staff.netlify.app,https://sanad-patient.netlify.app,http://localhost:3000,http://localhost:8080"
      - key: SEED_ON_STARTUP
        value: "true"

databases:
  # ============================================================================
  # PostgreSQL Database (Free Tier)
  # ============================================================================
  - name: sanad-db
    databaseName: sanad_db
    user: sanad
    region: frankfurt
    plan: free  # 256 MB, 90 Tage retention
    postgresMajorVersion: "16"
